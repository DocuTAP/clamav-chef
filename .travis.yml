language: ruby

branches:
  only:
    - master

sudo: required

services:
  - docker

install:
  - sudo apt-get purge -y lxc-docker
  - wget -qO- https://get.docker.com/ | sudo sh
  - curl -L https://www.chef.io/chef/install.sh | sudo bash -s -- -P chefdk
  - chef exec bundle install --without=development integration

before_script:
  - mkdir -p test/cookbooks/clamav_test/files
  - wget -P test/cookbooks/clamav_test/files http://database.clamav.net/main.cvd
  - wget -P test/cookbooks/clamav_test/files http://database.clamav.net/daily.cvd
  - wget -P test/cookbooks/clamav_test/files http://database.clamav.net/bytecode.cvd
  - cp .kitchen.travis.yml .kitchen.local.yml

script:
  - chef exec rake && chef exec kitchen test
